<?php
/*
--- © Omar Augusto Bautista MOra - UNAD - 2022 ---
--- omar.bautista@unad.edu.co - http://www.unad.edu.co
--- lunes, 28 de noviembre de 2022
--- El proposito de esta libreria es declarar la clase que maneja los gráficos estadísticos
--- y el mapa zonal
*/
class clsGraficos {
    var $aTitulos=array();
    var $aEtiquetas=array();
    var $aDatos=array();
    var $aGrupoDatos=array();
    var $aOrden=array();
    var $aColorFondo=array();
    var $sIdGrafico='';
    var $sLienzo='';
    var $sEtiquetas='';
    var $sTipo='';
    var $sTitulo='';
    var $iAncho='';
    var $iAlto='';
    var $sScript='';
    var $aPaletaUNAD=array(
		'Azul'=>array('#067ab0','#19688f','#005883','#004f75','#073452'),
		'Amarillo'=>array('#f5e517','#f1bb3e','#f0b429','#d8a224','#b68d2d'),
		'Naranja'=>array('#f7a51d','#f58636','#f47920','#db6c1c','#bc6128'),
		'Celeste'=>array('#a8def8','#55ccf5','#43c7f4','#3cb3db','#3598bc'),
		'Verde'=>array('#89c442','#61be5a','#50b748','#48a440','#3a9043'),
		'Magenta'=>array('#a6759d','#ae5892','#a54686','#943f78','#7d3265'),
		'Rojo'=>array('#81211b','#5f2d2d','#4e1616','#461313','#2b1212')
	);
	// var $aPaletaZonas=array(
	// 	3=>array('#ffd65b','#ffd147','#ffcc33','#e5b72d','#cca328'), //ZCAR
	// 	4=>array('#b13f97','#a7278a','#9e107e','#8e0e71','#7e0c64'), //ZOCC
	// 	5=>array('#4a608b','#344c7c','#1e396e','#1b3363','#182d58'), //ZCORI
	// 	6=>array('#ef984f','#ed8b39','#ec7f24','#d47220','#bc651c'), //ZCBOY
	// 	7=>array('#cbd732','#c4d219','#becd00','#abb800','#98a400'), //ZCSUR
	// 	8=>array('#bf365e','#b71d4a','#af0536','#9d0430','#8c042b'), //ZSUR
	// 	9=>array('#a6635d','#9b5049','#903d35','#81362f','#73302a'), //ZCBOG
	// 	10=>array('#89a366','#7a9754','#6c8c41','#617e3a','#567034') //ZAO
	// );
    var $aPaletaZonas=array(
		3=>array('#ffcc33','#cca328'), //ZCAR
		4=>array('#9e107e','#7e0c64'), //ZOCC
		5=>array('#1e396e','#182d58'), //ZCORI
		6=>array('#ec7f24','#bc651c'), //ZCBOY
		7=>array('#becd00','#98a400'), //ZCSUR
		8=>array('#b71d4a','#8c042b'), //ZSUR
		9=>array('#9b5049','#73302a'), //ZCBOG
		10=>array('#7a9754','#567034') //ZAO
	);
	var $aPaletaEscuelas=array(
		20000=>array('#067ab0','#19688f','#005883','#004f75','#073452'), //ECBTI
		40000=>array('#f5e517','#f1bb3e','#f0b429','#d8a224','#b68d2d'), //ECSAH
		10000=>array('#f7a51d','#f58636','#f47920','#db6c1c','#bc6128'), //ECACEN
		15000=>array('#a8def8','#55ccf5','#43c7f4','#3cb3db','#3598bc'), //ECISA
		30000=>array('#89c442','#61be5a','#50b748','#48a440','#3a9043'), //ECAPMA
		50000=>array('#a6759d','#ae5892','#a54686','#943f78','#7d3265'), //ECEDU
		25000=>array('#81211b','#5f2d2d','#4e1616','#461313','#2b1212') //ECJP
	);
    function paletaColores($iCantidad,$sColorFondo) {
        $aPaletaFondo=array();
        $aPaletaLinea=array();
        $sPaletaFondo='';
        $sPaletaLinea='';
        $aPaleta1=array('#FF0000','#FF0000','#FF00FF','#FFFF00','#FF9933','#FFFFFF','#eaecee','#FFFFFF','#FF0080','#FF8000','#FFF080','#FF8080','#FF0000');
        $aPaleta2=array('#c70039','#ff5733','#ff8d1a','#ffc300','#eddd53','#add45c','#57c785','#00baad','#2a7b9b','#3d3d6b','#511849','#900c3f');
        switch ($sColorFondo) {
            case 'paleta1':
                $aPaletaFondo=array_slice($aPaleta1,0,$iCantidad);
                $aPaletaLinea=array_fill(0,$iCantidad,'#000000');
                $sPaletaFondo='"'.implode('","',$aPaletaFondo).'"';
                $sPaletaLinea='"'.implode('","',$aPaletaLinea).'"';
                break;
            case 'paleta2':
                $aPaletaFondo=array_slice($aPaleta2,0,$iCantidad);
                $aPaletaLinea=array_fill(0,$iCantidad,'#000000');
                $sPaletaFondo='"'.implode('","',$aPaletaFondo).'"';
                $sPaletaLinea='"'.implode('","',$aPaletaLinea).'"';
                break;
            default:
                $aPaletaFondo=array_fill(0,$iCantidad,'window.Color("'.$sColorFondo.'").rgbString()');
                $aPaletaLinea=array_fill(0,$iCantidad,'#000000');
                $sPaletaFondo=implode(',',$aPaletaFondo);
                $sPaletaLinea='"'.implode('","',$aPaletaLinea).'"';
                break;
            }
            return array($sPaletaFondo,$sPaletaLinea);
        }
    function construyeGrupoDatos() {
        if($this->sTipo=='map') {

            } else {
            $sScriptObjetos = '[';
            $aScriptObjetos = array();
            $iCantidad = count($this->aEtiquetas);
            for ($i = 0; $i < count($this->aTitulos); $i++) {
                $aGrupoDatos = array_fill_keys($this->aEtiquetas, 0);
                foreach ($this->aDatos[$i] as $k => $v) {
                    $aGrupoDatos[$k] = $v;
                    }
                list($sColoresFondo, $sColoresLinea) = $this->paletaColores($iCantidad, $this->aColorFondo[$i]);
                $aScriptObjetos[] = '{
                label: "' . $this->aTitulos[$i] . '",
                stack: "Stack ' . $this->aOrden[$i] . '",
                data: [' . implode(',', $aGrupoDatos) . '],
                backgroundColor: [' . $sColoresFondo . '],
                borderColor: [' . $sColoresLinea . '],
                borderWidth: 1
                }';
                }
            $sScriptObjetos .= implode(',', $aScriptObjetos) . ']';
            }
        return $sScriptObjetos;
        }
    function construyeLienzo($iAncho, $iAlto) {
        $this->iAlto=$iAlto;
        $this->iAncho=$iAncho;
        if($this->sTipo=='map') {
            require './app.php';
            $this->sLienzo='<label class="TituloGrupo">' . $this->sTitulo . '</label><div class="salto1px"></div>
            <div id="Map_Content" align="center">
<img src="'.$APP->rutacomun.'imagenes/mapa-zonas.jpg" alt="Mapa Zonas UNAD" width="'.$this->iAncho.'" height="'.$this->iAlto.'" border="0" usemap="#'.$this->sIdGrafico.'_mapa" class="map">
<map name="'.$this->sIdGrafico.'_mapa" id="'.$this->sIdGrafico.'_mapa">
<area shape="poly" coords="95,110,100,105,105,98,111,95,115,97,120,91,117,87,118,82,118,78,120,73,121,62,125,58,128,58,129,53,132,53,138,48,143,47,145,49,152,49,157,49,158,44,158,38,164,38,170,41,175,42,178,41,180,43,185,41,190,36,196,33,203,28,211,26,216,23,218,18,219,12,223,12,225,13,228,13,227,10,229,7,232,6,236,5,244,7,247,12,250,16,249,19,244,22,236,26,231,27,227,28,225,33,220,41,215,47,211,47,209,52,207,57,202,63,198,64,197,71,198,79,194,85,194,89,194,93,189,99,187,104,185,108,184,114,180,123,181,127,180,129,185,128,187,129,186,132,187,135,189,140,190,143,189,147,184,149,178,149,175,149,175,146,176,141,174,137,173,134,170,136,172,142,171,150,168,155,169,161,164,165,160,168,157,166,156,161,157,156,156,154,152,156,151,155,150,152,151,147,149,143,150,139,146,136,140,135,138,138,136,139,132,138,130,137,126,140,124,144,120,149,120,154,116,159,112,161,111,160,110,157,108,154,103,153,95,154,93,154,93,147,93,141,95,136,97,134,97,130,100,127,101,125,99,122,96,120,95,116,94,110" class="ZCAR" href="#" title="Zona Caribe - ZCAR" onfocus="this.blur()" />
<area shape="poly" coords="93,111,89,114,86,119,80,120,79,121,82,124,84,125,84,132,85,134,86,136,82,139,81,141,79,139,78,138,78,134,77,130,74,129,70,127,68,125,68,121,67,119,65,121,64,125,66,128,68,132,71,136,71,140,70,143,67,144,66,147,62,152,59,153,59,150,56,148,55,148,55,150,56,152,56,154,52,156,52,160,52,164,54,166,56,167,55,170,56,171,58,172,59,175,62,176,63,176,64,180,66,182,66,184,64,187,64,189,62,189,61,191,63,193,64,195,66,196,66,199,68,200,68,203,67,205,66,208,63,209,62,210,60,211,61,213,63,213,64,215,64,219,65,224,65,228,65,232,67,232,66,235,65,237,65,242,65,245,62,248,61,251,62,254,65,254,66,252,71,253,77,253,82,255,86,256,90,255,95,254,95,251,96,250,93,248,92,247,93,244,95,241,96,238,97,235,101,232,105,229,107,230,108,232,113,235,114,236,114,239,112,242,113,246,114,248,114,251,116,253,118,252,119,251,121,247,123,243,125,237,127,235,127,230,128,226,130,223,133,223,136,222,137,219,141,218,143,219,145,218,146,217,147,215,148,213,147,210,147,206,148,202,149,199,150,195,152,191,154,188,155,184,155,181,156,179,158,177,162,176,164,174,165,172,166,170,168,169,171,167,172,164,172,162,170,162,168,161,164,166,162,167,160,169,158,167,156,165,157,162,158,158,157,156,157,155,153,156,150,155,151,153,151,148,151,146,150,143,150,140,148,138,146,136,143,136,140,135,138,137,136,139,134,139,133,137,130,137,125,139,124,144,123,146,120,150,120,152,119,155,116,158,113,161,111,161,111,159,110,157,108,154,105,154,101,154,97,154,94,155,92,154,93,149,93,144,93,139,96,135,97,132,97,129,99,127,100,125,97,122,96,119,94,116,95,113,94,111" class="ZOCC" href="#" title="Zona Occidente - ZOCC" onfocus="this.blur()" />
<area shape="poly" coords="187,103,185,107,184,109,184,113,183,117,183,119,181,123,181,124,180,128,180,129,183,128,185,127,186,127,186,130,187,133,187,137,189,140,190,144,190,147,186,148,181,149,177,149,175,148,174,146,175,143,176,141,175,138,174,135,171,135,170,136,170,139,171,143,172,146,171,150,170,153,169,155,168,158,168,160,170,162,172,162,172,164,172,166,170,167,168,169,167,170,165,171,165,174,163,176,159,177,157,178,155,180,155,183,154,186,152,188,151,191,151,193,153,193,154,195,154,197,156,197,159,197,159,200,160,202,162,202,163,202,165,203,166,205,169,206,174,206,176,206,178,205,178,201,181,198,181,196,183,196,185,196,186,197,187,199,187,200,186,202,185,203,187,203,191,203,193,202,193,200,193,199,200,196,202,193,204,193,206,190,204,188,204,184,205,181,207,182,211,182,212,180,213,179,215,177,216,174,216,171,215,169,215,167,215,165,219,164,223,164,224,162,223,158,221,156,217,156,214,154,213,151,213,148,212,146,213,143,214,140,213,139,212,138,213,135,216,136,217,133,217,129,216,127,214,125,211,123,208,119,205,116,205,112,204,108,203,104,197,105,196,103,193,102,188,103" class="ZCORI" href="#" title="Zona Centro Oriente - ZCORI" onfocus="this.blur()" />
<area shape="poly" coords="228,166,231,164,233,164,236,166,257,166,260,165,262,163,265,163,266,164,266,165,269,164,270,164,271,166,274,166,277,168,279,167,280,166,282,167,303,190,304,192,301,194,298,194,289,193,282,188,274,188,273,189,257,190,255,188,250,188,246,190,242,192,238,191,233,192,230,192,225,194,223,196,220,194,219,192,216,190,216,186,219,185,223,183,225,182,225,176,225,173,226,171,228,169" class="ZCORI" href="#" title="Zona Centro Oriente - ZCORI" onfocus="this.blur()" />
<area shape="poly" coords="151,192,149,197,148,200,148,203,147,204,147,207,151,207,153,205,157,204,159,204,160,207,160,210,162,212,163,213,163,215,167,217,170,216,170,213,172,211,174,212,177,214,179,215,179,217,179,219,180,221,183,222,184,224,184,226,182,228,183,232,185,233,194,237,195,235,198,234,200,232,200,229,199,226,200,222,201,220,203,218,205,219,205,221,209,222,211,222,213,221,215,221,216,219,216,215,220,216,223,215,225,213,225,211,225,209,225,207,224,206,223,206,219,206,219,203,221,199,220,198,219,196,218,193,217,191,216,190,216,189,216,187,217,185,219,185,224,182,225,181,226,175,227,170,228,168,226,165,223,164,220,164,217,164,215,164,214,168,216,170,216,172,216,175,214,178,212,181,210,183,207,182,206,182,203,183,203,185,204,190,204,191,203,192,199,194,197,197,195,199,192,199,192,202,190,202,187,203,185,201,187,199,186,197,185,196,182,196,179,198,179,199,177,203,177,205,177,206,174,206,169,206,167,206,166,205,165,203,164,202" class="ZCBOY" href="#" title="Zona Centro Boyacá - ZCBOY" onfocus="this.blur()" />
<area shape="poly" coords="147,207,151,206,156,204,158,203,159,204,159,207,160,210,162,211,162,214,163,215,166,218,168,216,170,215,171,212,172,211,174,212,177,214,179,215,179,219,180,221,182,222,183,223,184,225,183,227,182,229,182,230,185,232,189,234,195,237,195,241,195,245,195,248,194,249,192,248,191,247,187,247,183,248,181,247,180,244,180,242,176,243,174,245,174,248,174,251,172,252,171,253,167,253,165,251,164,251,163,252,162,255,162,260,159,262,158,264,155,265,153,262,151,261,151,258,152,255,153,252,153,249,151,247,149,249,147,250,146,250,143,248,142,248,142,245,143,243,143,240,142,237,142,234,144,232,144,229,144,226,146,221,145,219,148,215,149,214,148,211,147,208" class="ZCBOG" href="#" title="Zona Centro Bogotá Cundinamarca - ZCBC" onfocus="this.blur()" />
<area shape="poly" coords="144,219,140,218,137,219,135,221,132,223,129,223,127,227,126,230,126,234,124,238,123,242,120,247,120,249,117,252,116,254,116,256,116,259,113,259,110,261,110,266,110,270,108,274,107,279,105,282,106,285,107,288,109,291,110,294,112,297,112,300,112,302,111,303,109,302,107,303,106,305,103,304,101,303,99,303,97,304,96,304,96,307,97,310,97,312,95,314,93,316,91,319,94,320,95,320,95,322,94,325,95,328,98,328,100,329,101,332,101,335,101,338,101,340,103,341,107,344,112,348,116,348,121,349,122,350,123,351,126,352,127,352,128,355,130,356,131,359,133,359,135,359,137,359,137,362,138,365,140,366,144,367,146,368,148,369,147,373,148,375,152,378,156,379,160,380,163,379,165,379,169,380,171,381,171,383,173,386,178,384,180,384,182,382,183,382,185,382,186,384,188,385,189,387,192,386,194,385,196,385,199,385,201,386,203,387,205,386,207,388,211,388,212,387,215,386,220,387,223,382,227,376,233,370,240,366,246,362,244,357,240,355,234,355,231,354,228,350,225,348,217,345,210,344,206,339,201,339,199,335,195,330,190,326,187,324,184,323,177,321,168,318,162,313,157,311,153,308,148,305,147,302,142,299,140,297,138,294,138,289,143,285,148,282,150,279,149,273,151,269,155,268,155,265,152,262,151,260,151,256,153,253,153,250,152,249,151,248,147,250,144,250,142,248,142,245,143,243,143,240,142,237,143,234,144,231,145,228,144,224,146,221" class="ZSUR" href="#" title="Zona Sur - ZSUR" onfocus="this.blur()" />
<area shape="poly" coords="65,254,67,252,70,252,72,253,78,253,80,254,83,256,85,256,89,256,92,254,95,253,96,251,95,248,91,248,92,245,92,244,95,242,96,240,96,236,99,233,102,233,103,230,105,229,107,229,109,232,111,235,114,235,115,238,114,240,112,243,113,246,114,251,116,253,116,258,114,258,111,260,109,262,110,265,109,270,107,274,107,278,106,280,105,282,106,284,106,286,107,287,109,292,112,295,113,301,113,303,111,302,109,302,107,304,106,305,102,304,99,303,97,303,96,306,97,310,97,313,96,314,93,316,92,318,92,320,95,320,95,322,94,326,96,326,95,327,98,328,100,329,101,332,102,337,101,341,106,344,109,347,111,348,116,348,121,349,121,350,124,351,127,352,128,352,128,356,132,357,131,360,135,359,136,359,137,363,139,365,141,366,144,367,147,369,148,369,148,372,148,374,149,375,153,378,157,380,162,380,165,380,167,379,167,380,159,390,156,390,153,387,152,384,149,382,147,383,145,381,145,379,143,378,142,379,140,380,136,378,135,376,134,375,132,376,129,377,126,376,124,374,122,372,118,372,113,371,112,370,111,366,108,363,104,361,101,361,98,362,96,363,96,366,93,366,90,367,87,365,81,364,77,364,73,364,68,363,65,363,63,362,62,361,63,357,63,355,61,354,57,355,57,353,57,350,54,348,53,350,51,350,48,350,45,346,42,344,36,341,32,338,27,336,22,334,18,331,14,328,16,325,20,321,24,320,26,321,29,322,29,321,29,319,28,317,25,316,25,314,27,310,28,310,30,308,28,307,26,306,29,303,31,300,34,298,37,297,39,298,44,296,46,296,50,295,52,293,54,289,56,285,58,281,61,278,61,276,66,272,68,268,71,265,72,263,73,261,73,257,72,258,71,260,70,261,67,260,67,259,67,256,63,254" class="ZCSUR" href="#" title="Zona Centro Sur - ZCSUR" onfocus="this.blur()" />
<area shape="poly" coords="218,192,222,196,225,196,228,193,234,192,242,191,250,189,256,189,260,190,273,189,278,188,281,189,288,193,294,195,301,195,305,192,307,192,308,193,311,193,314,189,317,189,319,191,326,192,332,191,337,190,341,189,346,188,349,188,353,185,363,187,365,191,365,194,364,197,361,200,359,201,359,210,356,212,354,214,352,216,354,218,354,223,352,228,351,231,352,234,352,239,354,243,354,248,355,251,357,252,357,256,358,260,361,261,365,263,367,267,368,273,365,276,361,279,356,283,353,287,353,290,357,290,359,290,360,292,360,294,364,294,372,301,372,304,372,305,375,309,379,326,381,328,382,334,382,336,381,338,377,339,376,338,375,335,375,331,374,329,374,325,373,322,371,320,369,318,368,316,368,311,368,309,366,308,362,309,358,312,355,317,354,320,352,322,348,320,347,317,345,314,343,313,341,314,340,316,342,318,342,320,342,322,307,321,304,320,301,320,298,321,294,320,292,321,293,340,294,341,298,342,305,341,308,341,310,343,311,345,311,348,313,350,313,352,312,353,309,351,308,350,304,350,301,352,298,353,294,354,290,355,287,355,286,378,300,389,300,390,299,393,300,398,302,399,304,404,305,406,306,409,307,413,306,414,304,413,291,497,281,485,281,481,278,481,274,485,272,484,271,483,289,453,288,451,287,451,285,450,284,447,282,447,282,445,278,444,275,444,273,443,272,443,271,445,270,443,268,441,269,440,262,437,257,437,254,440,250,441,247,441,245,439,244,439,242,438,239,437,238,436,236,436,233,438,231,440,224,442,222,443,221,443,219,444,218,444,216,443,216,442,212,443,211,442,210,442,207,443,205,443,201,443,199,441,200,441,199,441,198,440,197,441,196,441,195,436,197,435,197,434,196,433,194,432,195,424,195,423,194,423,193,422,191,424,188,425,186,423,185,422,185,421,186,420,186,416,178,409,176,409,174,409,173,408,173,406,167,401,164,403,160,400,160,398,161,396,158,395,158,392,158,390,167,381,168,381,171,382,171,384,171,386,176,387,179,384,182,383,183,382,184,382,185,383,186,385,188,387,192,387,194,385,197,384,200,387,203,387,206,386,207,388,211,388,212,387,219,386,221,386,221,383,224,379,229,375,235,369,240,367,244,364,245,361,239,356,239,355,236,355,232,355,227,349,221,346,215,345,211,344,209,343,207,340,207,339,200,339,197,337,195,332,192,328,189,325,187,323,181,322,177,321,172,319,169,315,161,312,156,311,154,309,149,307,148,302,144,300,142,298,139,297,138,293,138,290,141,286,146,283,150,281,149,277,149,272,153,267,157,262,160,260,162,258,164,252,164,251,167,253,169,254,173,253,174,250,174,248,176,244,177,242,179,243,179,245,180,247,183,248,186,247,191,249,193,250,195,247,195,237,197,234,199,233,200,232,200,228,200,224,201,221,202,218,203,218,205,219,205,221,206,222,211,222,215,221,217,219,216,216,216,215,219,215,222,215,227,214,225,208,226,207,223,205,221,204,219,202,220,197,218,194" class="ZAO" href="#" title="Zona Amazónia Orinoquía - ZAO" onfocus="this.blur()" />
</map>
</div>';
            } else {
            $this->sLienzo = '<canvas id="' . $this->sIdGrafico . '" width="' . $this->iAncho . '" height="' . $this->iAlto . '"></canvas>';
            }
        return $this->sLienzo;
        }
    function construyeScript($aTitulos, $aDatos, $aEtiquetas=null, $aOrden=null, $aColorFondo=null) {
        $this->aTitulos = $aTitulos;
        $this->aEtiquetas = $aEtiquetas;
        $this->aDatos = $aDatos;
        $this->aOrden = $aOrden;
        $this->aColorFondo = $aColorFondo;
        if($this->sTipo=='map') {
            $sScriptObjetos = '';
            $this->sScript = '';
            foreach ($this->aTitulos as $sNomenclatura=>$sTitulo){
                $sScriptObjetos = '<h6>'.$sTitulo.'</h6>';
                $sScriptObjetos .= $this->aDatos[$sNomenclatura];
                $this->sScript .= '$(".qtip").remove();';
                $this->sScript .= '$(".'.$sNomenclatura.'").prop("title", "'.$sScriptObjetos.'");';
                }
            $this->sScript .= '$(".map").maphilight({"stroke":false,"strokeColor":"ffffff","strokeWidth":5,"fillColor":"ffffff"});
$("area[title]").qtip({position: {target: "mouse", adjust: { x: 5, y: 5 }}});';
            } else {
            $this->sEtiquetas = '["' . implode('","', $aEtiquetas) . '"]';
            $this->aGrupoDatos = $this->construyeGrupoDatos();
            $this->sScript = 'var ctx = document.getElementById("' . $this->sIdGrafico . '").getContext("2d");';
            $this->sScript .= 'var myChart = new Chart(ctx, {';// abre Chart
            $this->sScript .= 'type: "' . $this->sTipo . '",';
            $this->sScript .= 'data: {labels: ' . $this->sEtiquetas . ',datasets: ' . $this->aGrupoDatos . '},';
            $this->sScript .= 'options: {scales: {';// abre options
            $this->sScript .= 'xAxes: [{ }],';
            $this->sScript .= 'yAxes: [{ticks: {beginAtZero: true}}]';
            $this->sScript .= '}}';// cierre options
            $this->sScript .= '});';// cierre Chart
            }
        return $this->sScript;
        }
    function __construct($sIdGrafico, $sTipo, $sTitulo) {
        $this->sIdGrafico=$sIdGrafico;
        $this->sTipo=$sTipo;
        $this->sTitulo=$sTitulo;
        }
    function __destruct(){
        }
}
